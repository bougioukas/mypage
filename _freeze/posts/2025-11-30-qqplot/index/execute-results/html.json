{
  "hash": "fcbc1d591c464aee32ee1dc72ab09345",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Normal Q-Q plot: A step-by-step approach\"\ndescription: \"A normal Q-Q plot allows you to visually assess whether your data follow a normal distribution.\"\nauthor: \n    - name: Konstantinos Bougioukas \ndate: \"2025-11-30\"\ncategories: [visualization]\nimage: \"qqplot.png\"\ncss: /custom.css\n#draft: true\n---\n\n\n\n\nA normal Q-Q plot is a visualization for assessing whether a given sample is consistent with a normal (Gaussian) distribution. It is constructed by plotting the theoretical quantiles of a standard normal distribution on the horizontal axis against the sample quantiles (i.e., the ordered values of the dataset) on the vertical axis.\n\n\n### Sample quantiles\n\nLet Y be a random variable with $n$ observations $y_1, y_2,..., y_n$. First, we sort the observations from smallest to largest: $y_{(1)} \\leq y_{(2)} \\leq \\cdots \\leq y_{(n)}$. Then, for each ordered value $y_{(i)}$ (sample quantile), we assign a cumulative probability—referred to as plotting position—according to Hazen's formula $P_i = \\frac{i-0.5}{n}$, where $i = 1, 2, ..., n$ ([@tbl-quantiles]). This convention, originally proposed by @Hazen1914 and later discussed by @CUNNANE1978, is often applied for sufficiently large sample sizes (e.g. n > 10).\n\n\n| Sample quantile <br> $y_{(i)}$ | Plotting position <br> $P_i = \\frac{i-0.5}{n}$ |\n|:----------------------------:|:---------------------------------------------:|\n| $y_{(1)}$ | $\\frac{0.5}{n}$ |\n| $y_{(2)}$ | $\\frac{1.5}{n}$ |\n| $y_{(3)}$ | $\\frac{2.5}{n}$ |\n| $\\vdots$ | $\\vdots$ |\n| $y_{(n)}$ | $\\frac{n-0.5}{n}$ |\n\n: Sample quantiles and plotting positions for $n>10$ {#tbl-quantiles}\n\n\n​\n\n**Example:** Twenty 9-year-old children with age-appropriate development completed a visual matching task on a computer. A target image appeared on the left, and either an identical copy or mirror image appeared on the right. Children pressed one key for matches and another for mirror images. The data represents reaction times (RT) in milliseconds for the 20 children ([@tbl-reaction_times]).\n\n\n| | | | | | | | | | |\n|:----:|:----:|:----:|:----:|:----:|:----:|:----:|:----:|:----:|:----:|\n| 2549 | 1938 | 1698 | 1725 | 1236 | 2953 | 1367 | 837 | 1843 | 1369 |\n| 1400 | 3696 | 5179 | 1584 | 1908 | 1415 | 4417 | 1500 | 2265 | 1687 |\n\n: Reaction times (RT) in milliseconds for 20 children {#tbl-reaction_times}\n\n​\n\nApplying Hazen’s rule, we compute the plotting positions (cumulative probability estimates) for each sample quantile, as shown in [@tbl-quantiles2].\n\n​\n\n| | **Sample quantile** <br> $y_{(i)}$ | **Plotting position** <br> $P_i = (i-0.5)/20$ |\n|---|:-----------------------------:|:-----------------------------------------:|\n| | 837 | 0.025 |\n| | 1236 | 0.075 |\n| | 1367 | 0.125 |\n| | 1369 | 0.175 |\n| | 1400 | 0.225 |\n| | 1415 | 0.275 |\n| | 1500 | 0.325 |\n| | 1584 | 0.375 |\n| | 1687 | 0.425 |\n| | 1698 | 0.475 |\n| | 1725 | 0.525 |\n| | 1843 | 0.575 |\n| | 1908 | 0.625 |\n| | 1938 | 0.675 |\n| | 2265 | 0.725 |\n| | 2549 | 0.775 |\n| | 2953 | 0.825 |\n| | 3696 | 0.875 |\n| | 4417 | 0.925 |\n| | 5179 | 0.975 |\n\n: Sample quantiles and plotting positions for 20 reaction times {#tbl-quantiles2}\n\n\n​\n\n**In R**\n\nThe reaction times are:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ny <- c(2549, 1938, 1698, 1725, 1236, 2953, 1367, 837, 1843, 1369, \n       1400, 3696, 5179, 1584, 1908, 1415, 4417, 1500, 2265, 1687)\n```\n:::\n\n\n\n​\n\n\nWe sort the these observations form the smallest to largest:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ny_sorted <- sort(y)\ny_sorted\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1]  837 1236 1367 1369 1400 1415 1500 1584 1687 1698 1725 1843 1908 1938 2265\n[16] 2549 2953 3696 4417 5179\n```\n\n\n:::\n:::\n\n\n\n​\n\nThen, we compute the plotting position $P_i$ for each $i = 1, 2, ..., n$:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nn <- length(y)\ni <- seq_len(n)\nPi <- (i - 0.5) / n\nPi\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] 0.025 0.075 0.125 0.175 0.225 0.275 0.325 0.375 0.425 0.475 0.525 0.575\n[13] 0.625 0.675 0.725 0.775 0.825 0.875 0.925 0.975\n```\n\n\n:::\n:::\n\n\n\n​\n\n### Theoretical quantiles\n\nThe theoretical quantiles are the z-values from the standard normal distribution corresponding to the plotting positions. For each cumulative probability $P_i$, the theoretical quantile $z_i$ is the value such that: $P(Z< z_i) = P_i$, where $Z \\sim N(0,1)$ is a standard normal random variable.\n\nThe z-value can be calculated using $z_i = \\Phi^{-1}(P_i)$, where $\\Phi^{-1}$ is the inverse cumulative distribution function of the standard normal distribution. As an example, for the first ($i=1$) plotting position, we have $P_1 = 0.025$. Therefore: $P(Z < z_1) = 0.025 \\Rightarrow z_1 = \\Phi^{-1}(0.025) \\approx -1.96$ ([@tbl-pi_zi]). This means that 2.5% of the standard normal distribution falls below $z_1 = -1.96$.\n\n\n\n| **Plotting position** <br> $P_i$ | **Theoretical quantile** <br> $z_i = \\Phi^{-1}(P_i)$ |\n|:---------------------------:|:------------------------------------------------:|\n| 0.025 | -1.96 |\n| 0.075 | -1.44 |\n| 0.125 | -1.15 |\n| 0.175 | -0.93 |\n| 0.225 | -0.76 |\n| 0.275 | -0.60 |\n| 0.325 | -0.45 |\n| 0.375 | -0.32 |\n| 0.425 | -0.19 |\n| 0.475 | -0.06 |\n| 0.525 | 0.06 |\n| 0.575 | 0.19 |\n| 0.625 | 0.32 |\n| 0.675 | 0.45 |\n| 0.725 | 0.60 |\n| 0.775 | 0.76 |\n| 0.825 | 0.93 |\n| 0.875 | 1.15 |\n| 0.925 | 1.44 |\n| 0.975 | 1.96 |\n\n: Plotting positions and theoretical quantiles {#tbl-pi_zi}\n\n**In R**\n\nThe theoretical quantiles can be calculated using the `qnorm()` function:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nz_i <- qnorm(Pi)\nz_i\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] -1.95996398 -1.43953147 -1.15034938 -0.93458929 -0.75541503 -0.59776013\n [7] -0.45376219 -0.31863936 -0.18911843 -0.06270678  0.06270678  0.18911843\n[13]  0.31863936  0.45376219  0.59776013  0.75541503  0.93458929  1.15034938\n[19]  1.43953147  1.95996398\n```\n\n\n:::\n:::\n\n\n\n\n\n### The Q-Q plot\n\nThe last step is to generate the normal Q-Q plot by plotting the theoretical quantiles ($z_i$) on the x-axis against the sample quantiles ($y_{(i)}$) on the y-axis using the values from [@tbl-qq_data].\n\n| **Theoretical quantile** <br> $z_i$ | **Sample quantile** <br> $y_{(i)}$ |\n|:------------------------------:|:-----------------------------:|\n| -1.96 | 837 |\n| -1.44 | 1236 |\n| -1.15 | 1367 |\n| -0.93 | 1369 |\n| -0.76 | 1400 |\n| -0.60 | 1415 |\n| -0.45 | 1500 |\n| -0.32 | 1584 |\n| -0.19 | 1687 |\n| -0.06 | 1698 |\n| 0.06 | 1725 |\n| 0.19 | 1843 |\n| 0.32 | 1908 |\n| 0.45 | 1938 |\n| 0.60 | 2265 |\n| 0.76 | 2549 |\n| 0.93 | 2953 |\n| 1.15 | 3696 |\n| 1.44 | 4417 |\n| 1.96 | 5179 |\n\n: Theoretical quantiles and sample quantiles for RT data {#tbl-qq_data}\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Make QQ plot\nplot(z_i, y_sorted,\n     xlab = \"Theoretical Quantiles\", \n     ylab = \"Sample Quantiles\", \n     main = \"Normal Q-Q Plot\",\n     pch = 1, col = \"black\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=480}\n:::\n:::\n\n\n\n\n\n### Adding a reference line (Quartile Method)\n\nThe Quartile Method is a robust technique for defining a reference line on a Quantile-Quantile (Q-Q) plot. The line passes through the first quartile ($Q_1$) and third quartile ($Q_3$) of both the theoretical and sample distributions.\n\nThe reference line is $y = b_o + b_1 z$, where the slope and intercept are calculated as:\n\n$b_1 = \\frac{y_{0.75} - y_{0.25}}{z_{0.75} - z_{0.25}}$\n\n$b_0 = y_{0.25} - b_1 \\, z_{0.25}$\n\nHere, $z_{0.25}$ and $z_{0.75}$ are the first and third quartiles of the theoretical standard normal distribution, while $y_{0.25}$ and $y_{0.75}$ are the corresponding quartiles of the sample.\n\n​\n\n**In R**\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Compute quartiles\nz25 <- qnorm(0.25)\nz75 <- qnorm(0.75)\ny25 <- quantile(y, 0.25)\ny75<- quantile(y, 0.75)\n\n# Compute line parameters\nb1 <- (y75 - y25) / (z75 - z25)\nb0 <- y25 - b1 * z25\n```\n:::\n\n\n\n​\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Make QQ plot\nplot(z_i, y_sorted,\n     xlab = \"Theoretical Quantiles\", \n     ylab = \"Sample Quantiles\", \n     main = \"Normal Q-Q Plot\",\n     pch = 1, col = \"black\")\n\n# Add the quartile-based line\nabline(b0, b1, col = \"red\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-1.png){width=480}\n:::\n:::\n\n\n\nThe Q–Q plot shows clear deviations from the reference line, particularly in the upper tail, indicating that the data are not normally distributed and exhibit positive skewness. This conclusion is further supported by the histogram and boxplot, which display an asymmetric distribution of reaction times, with a long right tail and two outliers.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlayout(mat = matrix(c(1,2), ncol = 1), heights = c(2, 8))\n\n# Top: horizontal boxplot\npar(mar = c(0, 4, 1, 2))\nboxplot(y, horizontal = TRUE, axes = FALSE, \n        col = \"lightgray\", outline = TRUE)\n\n# Bottom: histogram\npar(mar = c(5, 4, 0, 2))\nhist(y, main = \"\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-8-1.png){width=480}\n:::\n:::\n\n\n\n​\n\nThe normal Q–Q plot can be generated using the built-in R functions `qqnorm()` and `qqline()`.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nqqnorm(y)\nqqline(y, col = \"red\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-9-1.png){width=480}\n:::\n:::\n\n\n\n\nWe can also add a box‑plot for the sample quantiles to the right-side of the Q–Q plot as follows:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Set up the plotting layout: 2 columns, first column wider\nlayout(matrix(c(1, 2), nrow = 1), widths = c(3, 0.6))\n\n# Set margins for both plots\npar(mar = c(5, 4, 4, 1))\n\n# Create Q-Q plot\nqqnorm(y)\nqqline(y, col = \"red\")\n\n# Set margins for boxplot (reduce left margin)\npar(mar = c(5, 1, 4, 2))\n\n# Create boxplot on the right\nboxplot(y, yaxt = \"n\", frame = FALSE, ylim = range(y))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-10-1.png){width=576}\n:::\n:::\n\n\n\n\n\n\n\n### References\n\n::: {#refs}\n:::\n\n\n<!--Include social share buttons-->\n\n\n\n<!-- \nAddToAny check more: https://www.addtoany.com/buttons/for/website \nUsing includes will make edits easier, will only need to add or remove button here if needed.\nhttps://quarto.org/docs/authoring/includes.html\n-->\n<div class=\"a2a_kit a2a_kit_size_32 a2a_default_style\">\n<a class=\"a2a_dd\" href=\"https://www.addtoany.com/share\"></a>\n<a class=\"a2a_button_linkedin\"></a>\n<a class=\"a2a_button_x\"></a>\n<a class=\"a2a_button_facebook\"></a>\n<a class=\"a2a_button_copy_link\"></a>\n<a class=\"a2a_button_email\"></a>\n</div>\n<script async src=\"https://static.addtoany.com/menu/page.js\"></script>\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}